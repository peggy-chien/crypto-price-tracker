import{n as l,u as c}from"./chunk-VUDITENN.js";var m=class a{streams=new Map;multiWs=null;multiSignal=c([]);multiPairs=[];subscribeToTicker(s){let e=s.toUpperCase();this.unsubscribeFromTicker(s);let r=c(null),i=new WebSocket(`wss://stream.binance.com:9443/ws/${s.toLowerCase()}@ticker`);return i.onmessage=t=>{try{let n=JSON.parse(t.data),o={symbol:n.s,price:parseFloat(n.c),change:parseFloat(n.P)};r.set(o)}catch(n){console.error("[BinanceWebsocketService] WebSocket message error:",n)}},i.onerror=t=>{console.error("[BinanceWebsocketService] WebSocket error:",t)},i.onclose=()=>{},this.streams.set(e,{ws:i,signal:r}),r}subscribeToTickers(s){this.unsubscribeFromTickers(),this.multiPairs=s;let e=s.map(i=>`${i.toLowerCase()}@ticker`).join("/");this.multiWs=new WebSocket(`wss://stream.binance.com:9443/stream?streams=${e}`);let r={};return this.multiWs.onmessage=i=>{try{let t=JSON.parse(i.data);if(t&&t.data&&t.stream){let n=t.data,o={symbol:n.s,price:parseFloat(n.c),change:parseFloat(n.P)};r[n.s]=o,this.multiSignal.set(Object.values(r))}}catch(t){console.error("[BinanceWebsocketService] Multi-ticker WebSocket message error:",t)}},this.multiWs.onerror=i=>{console.error("[BinanceWebsocketService] Multi-ticker WebSocket error:",i)},this.multiWs.onclose=()=>{},this.multiSignal}unsubscribeFromTicker(s){let e=s.toUpperCase(),r=this.streams.get(e);r&&(r.ws.onmessage=null,r.ws.onerror=null,r.ws.onclose=null,r.ws.close(),this.streams.delete(e))}unsubscribeFromTickers(){this.multiWs&&(this.multiWs.onmessage=null,this.multiWs.onerror=null,this.multiWs.onclose=null,this.multiWs.close(),this.multiWs=null,this.multiSignal.set([]),this.multiPairs=[])}closeAll(){for(let[s,e]of this.streams.entries())e.ws.onmessage=null,e.ws.onerror=null,e.ws.onclose=null,e.ws.close(),this.streams.delete(s);this.unsubscribeFromTickers()}getMultiSignal(){return this.multiSignal}static \u0275fac=function(e){return new(e||a)};static \u0275prov=l({token:a,factory:a.\u0275fac,providedIn:"root"})};export{m as a};
